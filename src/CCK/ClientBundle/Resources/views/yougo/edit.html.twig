{% extends "CCKClientBundle::layout.html.twig" %}

{% block stylesheets %}
	{{ parent() }}
	{% include 'CCKClientBundle:Common:style_yougo.html.twig' %}
{% endblock %}

{% block contents %}
<form class="form-horizontal" enctype='multipart/form-data' method='POST'  autocomplete="off" novalidate>
<div class="row">
	<div class="col-lg-12">
		<div class="panel-body">
			<div class="row">
				<div class="form-horizontal" id="form_mainterm">
					{% include 'CCKClientBundle:Common:header_yougo.html.twig' %}
					<hr class="divider">
					{% include 'CCKClientBundle:Common:mainterm.html.twig' %}
					<input type="hidden" class="form-control input-sm" id="update_mode" name="update_mode" value="edit">
				</div>
			</div>
		</div>
	</div>
</div>
{% include 'CCKClientBundle:Common:subterm.html.twig' %}
<div class="row">
	<div class="col-lg-12">
		<div class="text-center">
			<button type="button" class="btn btn-primary js-yougo-submit">{{ 'btn.submit'|trans }}</button>
		</div>
	</div>
</div>
</form>

<div class="content">

<div class="row">
	<div class="col-lg-12">
	</div>
</div>

</div>

<!-- サブ画面 -->
{% include 'CCKClientBundle:Common:subform_yougo.html.twig' %}

{% endblock %}

{% block javascripts %}
	{{ parent() }}
	{% include 'CCKClientBundle:Common:js_yougo.html.twig' %}
	<script>

		$(function(){
			$(window).load(function(){
				// 教科・版を変更不可にする
				$('[name="curriculum"]').prop("disabled", true);
				$('[name="version"]').prop("disabled", true);

				// 見出しの初期設定
				/*changeHenHeader($('.js-hen'),'sho','dai','chu','ko');
				changeShoHeader($('.js-sho'),'hen','dai','chu','ko');
				changeDaiHeader($('.js-dai'),'hen','sho','chu','ko');
				changeChuHeader($('.js-chu'),'hen','sho','dai','ko');*/
				setHeaderSelectedIdx("{{ yougo.headerId }}",'hen','sho','dai','chu','ko');

				// 掲載順リスト初期化
				buttonStyle(document.getElementById('print_order'));

				// 教科書頻度
				getTextPoint("{{ yougo.textFrequency }}","{{ yougo.termId }}");

				// サブ用語取得
				var yougo_sub = '{{ yougo_sub|json_encode|raw }}';
				console.log("**サブ用語**");
				console.log(yougo_sub);

				var yougo_sub_parse = JSON.parse(yougo_sub);
				console.log(yougo_sub_parse.length);

				var header_sub = '<div class="form-group"><div class="col-lg-12">サブ用語</div></div>';

				for(var i=0; i<yougo_sub_parse.length; i++){
					console.log(yougo_sub_parse[i].sub_term);

					if(i>0){header_sub = ''};

					$('#form_subterms').append(
						header_sub
						+ constructSubForm(yougo_sub_parse[i])
					);

					getTextPoint(yougo_sub_parse[i].text_frequency,yougo_sub_parse[i].id);

				}

				// 同対類用語取得
				var yougo_syn = '{{ yougo_syn|json_encode|raw }}';
				var yougo_syn_parse = JSON.parse(yougo_syn);
				var header_syn = '<div class="form-group"><div class="col-lg-12">同対類用語</div></div>';

				for(var i=0; i<yougo_syn_parse.length; i++){
					if(i>0){header_syn = ''};
					$('#form_synterms').append(
						header_syn
						+ constructSynForm(yougo_syn_parse[i])
					);
				}

				// 指矢印用語取得
				var yougo_ref = '{{ yougo_ref|json_encode|raw }}';
				var yougo_ref_parse = JSON.parse(yougo_ref);
				var header_ref = '<div class="form-group"><div class="col-lg-12">指矢印用語</div></div>';

				for(var i=0; i<yougo_ref_parse.length; i++){
					if(i>0){header_ref = ''};
					$('#form_refterms').append(
							header_ref
						+ constructRefForm(yougo_ref_parse[i])
					);

					$('[name="ref_hen'+yougo_ref_parse[i].id + '"]').val(yougo_ref_parse[i].hen);
					changeHenHeader($('[name="ref_hen'+yougo_ref_parse[i].id + '"]'),'ref_sho'+yougo_ref_parse[i].id,'ref_dai'+yougo_ref_parse[i].id,'ref_chu'+yougo_ref_parse[i].id,'ref_ko'+yougo_ref_parse[i].id,'ref_term'+yougo_ref_parse[i].id);
					$('[name="ref_sho'+yougo_ref_parse[i].id + '"]').val(yougo_ref_parse[i].sho);
					changeShoHeader($('[name="ref_sho'+yougo_ref_parse[i].id + '"]'),'ref_hen'+yougo_ref_parse[i].id,'ref_dai'+yougo_ref_parse[i].id,'ref_chu'+yougo_ref_parse[i].id,'ref_ko'+yougo_ref_parse[i].id,'ref_term'+yougo_ref_parse[i].id);
					$('[name="ref_dai'+yougo_ref_parse[i].id + '"]').val(yougo_ref_parse[i].dai);
					changeDaiHeader($('[name="ref_dai'+yougo_ref_parse[i].id + '"]'),'ref_hen'+yougo_ref_parse[i].id,'ref_sho'+yougo_ref_parse[i].id,'ref_chu'+yougo_ref_parse[i].id,'ref_ko'+yougo_ref_parse[i].id,'ref_term'+yougo_ref_parse[i].id);
					$('[name="ref_chu'+yougo_ref_parse[i].id + '"]').val(yougo_ref_parse[i].chu);
					changeChuHeader($('[name="ref_chu'+yougo_ref_parse[i].id + '"]'),'ref_hen'+yougo_ref_parse[i].id,'ref_sho'+yougo_ref_parse[i].id,'ref_dai'+yougo_ref_parse[i].id,'ref_ko'+yougo_ref_parse[i].id,'ref_term'+yougo_ref_parse[i].id);
					$('[name="ref_ko'+yougo_ref_parse[i].id + '"]').val(yougo_ref_parse[i].ko);
					setHeaderSelectedIdx(yougo_ref_parse[i].header_id,'ref_hen'+yougo_ref_parse[i].id,'ref_sho'+yougo_ref_parse[i].id,'ref_dai'+yougo_ref_parse[i].id,'ref_chu'+yougo_ref_parse[i].id,'ref_ko'+yougo_ref_parse[i].id);
					$('.form_refterm:last-child #ref_term').val(yougo_ref_parse[i].refer_term_id);
				}

				// サブ用語・同対類用語・指矢印用語フォームのイベント設定
				assignSubFormEvent();
			});
		});

	</script>
{% endblock %}
