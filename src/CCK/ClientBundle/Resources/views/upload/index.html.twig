{% extends "CCKClientBundle::layout.html.twig" %}

{% block stylesheets %}
	{{ parent() }}
{% endblock %}

{% block contents %}
<div class="row">
<blockquote class="blockquote-bottom pdr-0">
	<p>{{ 'text.csv.import.nombre'|trans|raw }}</p>
</blockquote>
</div>

<form action="{{ path('client.nombre.upload') }}" class="form-horizontal" enctype='multipart/form-data' method='POST' novalidate>
<div class="row">
	<div class="col-xs-12">
		<div class="panel panel-primary">
			<div class="panel-body">
				<div class="row">
					<div class="form-horizontal">
						<div class="">
							<div class="col-xs-12">
								<label class="col-xs-2">{{ 'text.csv.import.nombre'|trans }}</label>
								<div class="col-xs-2">
									<select class="form-control js-cur input-sm" name="curriculum">
										<option value="0">--------------</option>
										{% for cur in cur_list %}
											<option value="{{ cur.id }}">{{ cur.name }}</option>
										{% endfor %}
									</select>
								</div>
								<div class="col-xs-2">
									<select class="form-control js-han input-sm" name="version" disabled>
										<option value="0">--------------</option>
										{% for ver in ver_list %}
											<option value="{{ ver.id }}">{{ ver.name }}</option>
										{% endfor %}
									</select>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="form-horizontal">
						<div class="">
							<div class="col-xs-12">
								<div class="col-xs-4">
									<input type="file" id="up_file" name="image">
								</div>
								<div class="col-xs-5">
									{{ return_message }}
								</div>
								<div class="col-xs-2"><button id="up_submit" class="btn btn-primary btn-block" type="submit" onClick="return checkUpload()" disabled>{{ 'btn.upload'|trans }}</button></div>
								<!-- <div class="col-xs-1"><button id="log_download" class="btn btn-primary btn-block" type="button" onClick="return logDownload()" disabled>{{ 'btn.log'|trans }}</button></div> -->
								<div id="status" style="visibility: hidden;">{{ status }}</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
</form>
<form action="{{ path('client.log.download') }}" method="POST">
	<button id="log_download" class="btn btn-primary" disabled>{{ 'btn.log'|trans }}</button>
</form>

<div class="row">
<blockquote class="blockquote-bottom pdr-0">
	<p>{{ 'text.csv.import.list'|trans|raw }}</p>
</blockquote>
</div>

<div class="row">
	<div class="col-xs-12">
		<table class="table table-responsive table-striped">
			<thead>
				<tr>
					<th width="80px" class="text-left">{{ 'text.yougo.curriculum'|trans }}</th>
					<th width="80px" class="text-left">{{ 'text.yougo.version'|trans }}</th>
					<th width="80px" class="text-left">{{ 'text.yougo.upload_date'|trans }}</th>
					<th width="120px" class="text-center">{{ 'text.yougo.upload_user'|trans }}</th>
					<th width="120px" class="text-center">{{ 'text.yougo.upload_file'|trans }}</th>
				</tr>
			</thead>
			<tbody>
				{% for upload in upload_list %}
				<tr class="text-center">
					<td class="text-left">{{ upload.cur_name }}</td>
					<td class="text-left">{{ upload.ver_name }}</td>
					<td class="text-left">{{ upload.create_date|date('Y/m/d H:i') }}</td>
					<td class="text-left">{{ upload.user_name }}</td>
					<td class="text-left">{{ upload.file_name }}</td>
				</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>
</div>

<div class="modal-footer">
	<div class="text-center">
		<a href="{{ path('client.yougo.index') }}"><div class="btn btn-default" name="back">{{ 'btn.back'|trans }}</div></a>
	</div>
</div>

{% endblock %}

{% block javascripts %}
	{{ parent() }}
	<script>

	$(function(){
		$('.js-cur').bind('change', function(){
			changeCurriculumHeader($('.js-cur'));
		});

		$('.js-han').bind('change', function(){
			changeHanHeader($('.js-han'),'hen');
		});

		if($('#status').text() == "201"){
			$('#log_download').attr('disabled', false);
		}

	});

	function checkUpload(){
		if(($('.js-cur').val() == 0)||($('.js-han').val() == 0)){
			alert("教科・版を選択してください。");
			return false;
		}else{
			return true;
		}
	}

	function logDownload(){
		$.ajax({
			url: "{{ path('client.log.download') }}",
			data: null,
			method: 'POST',
			success: function(response){
				alert("OK");
			},
			error: function(response){
				alert("NG");
			}
		});
	}

	// アップロード csv ボタンactive化
	$('#up_file').bind('change', function(){
		if(this.files && this.files[0]){
			$('#up_submit').attr('disabled', false);
		}
	});
	</script>
{% endblock %}
