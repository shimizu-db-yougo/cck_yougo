<script>
		// 教科書頻度
		$('.js-text-freq').bind('keydown keyup keypress change', function () {

			getTextPoint($(this).val(),"{{ yougo.termId }}","{{ curriculum }}");

		});

		// センター頻度
		$(".js-center-target").bind('click', function(e){

			getCenterPoint(e);

		});

		$('.js-center-submit').bind('click', function(e){
			var center_cnt = 0;
			var point_list = $('input[id^="center_main"],input[id^="center_sub"]');
			var tbl_center_point = {};
			for(var i in point_list){
				console.log(point_list[i].value);
				if(point_list[i].value !== void 0){
					// 数値入力チェック
					if(isNaN(point_list[i].value)){
						alert("数字で入力して下さい。");
						return false;
					}

					center_cnt += Number(point_list[i].value);

					if(point_list[i].id.indexOf("center_main") !== -1){
						tbl_center_point[point_list[i].id.slice(-4)] = {};
						tbl_center_point[point_list[i].id.slice(-4)].main = Number(point_list[i].value);
					}
					if(point_list[i].id.indexOf("center_sub") !== -1){
						tbl_center_point[point_list[i].id.slice(-4)].sub = Number(point_list[i].value);
					}
					console.log(tbl_center_point);
				}
			}

			var term_id = $('#term_id').val();
			var yougo_flag = $('#yougo_flag').val();

			// センター頻度の登録
			var data = {
				'term_id': term_id,
				'center_tbl': tbl_center_point,
				'yougo_flag': yougo_flag
			};
			$.ajax({
				url: "{{ path('client.yougo.center.update.ajax') }}",
				data: data,
				method: 'POST',
				success: function(response){
				},
				error: function(response){
					alert("DBエラー");
				}
			});

			$('#center_freq' + term_id + ' #center_freq').text(center_cnt);
			$('#center_freq' + term_id + ' input:hidden[name="center_freq_text"]').val(center_cnt);

			$('#centerModal').modal('hide');
		});

		$(".js-center-delete").bind('click', function(e){
			var point_list = $('input[id^="center_main"],input[id^="center_sub"]');
			for(var i in point_list){
				if(point_list[i].value !== void 0){
					point_list[i].value = 0;
				}
			}
		});

		// 解説内さくいん用語
		$(".js-explain-target").bind('click', function(e){
			// get target
			var target = $(e.currentTarget);
			var main_term_id = target.attr('main-term-id');

			var explain_list = [];
			// 解説内索引用語の取得
			var data = {
				'term_id': main_term_id,
			};
			$.ajax({
				url: "{{ path('client.yougo.explain.ajax') }}",
				data: data,
				async: false,
				method: 'POST',
				success: function(response){
					$.each(response, function(key, list){
						explain_list.push(list);
					});
				},
				error: function(response){
				}
			});

			$('#form_explains').empty();
			// さくいん用語タグで囲まれた用語を抽出
			var match_regex = /(?<=\《c_SAK》).*?(?=\《\/c_SAK》)/g;
			var match_chr = '';
			var term_explain = $('#term_explain').val();

			match_chr = term_explain.match(match_regex);

			if(match_chr){
				// DBに登録されていないがWEBに入力された用語をマッチングして追加する
				var is_saved = false;

				for(var i=0; i<match_chr.length; i++){
					is_saved = false;
					for(idx in explain_list){
						console.log(explain_list[idx].indexTerm);

						if(match_chr[i] == explain_list[idx].indexTerm){
							is_saved = true;
							break;
						}
					}

					if(is_saved == false){
						var explain = {indexTerm:match_chr[i],indexAddLetter:'',indexKana:'',nombre:0};
						explain_list.push(explain);
					}
				}
			}


			if(explain_list){
				console.log(explain_list);

				if(match_chr){
					for(var i=0; i<explain_list.length; i++){
						// DBに登録されてWEBに入力されていない用語は表示しない
						console.log(explain_list[i].indexTerm);
						console.log(match_chr.indexOf(explain_list[i].indexTerm));

						if(match_chr.indexOf(explain_list[i].indexTerm) == -1){
							continue;
						}

						$('#form_explains').append(
								'<div class="col-xs-12 form_index">'
								+'<input class="form-control input-sm" type="hidden" id="explain_main_term_id" name="explain_main_term_id" value="' + main_term_id + '">'
								+'<input class="form-control input-sm" type="hidden" id="explain_index_term" name="explain_index_term" value="' + explain_list[i].indexTerm + '">'
								+'<input class="form-control input-sm" type="hidden" id="explain_nombre" name="explain_nombre" value="'+ explain_list[i].nombre + '">'
								+'<label class="col-xs-2">'+ explain_list[i].indexTerm + '</label>'
								+'<div class="col-xs-4"><input class="form-control input-sm" type="text" id="explain_index_kana" name="explain_index_kana" value="'+ explain_list[i].indexKana + '"></div>'
								+'<div class="col-xs-4"><input class="form-control input-sm" type="text" id="explain_index_add_letter" name="explain_index_add_letter" value="'+ explain_list[i].indexAddLetter + '"></div>'
								+'<label class="col-xs-2">'+ explain_list[i].nombre + '</label>'
								+'</div>');
					}
				}

			}

			$('#explainModal').modal();
		});

		$('.js-explain-submit').bind('click', function(e){
			console.log($('#form_mainterm [id=term_explain]').val());
			var explain = {term_id:[],index_term:[],index_add_letter:[],index_kana:[],nombre:[],mainterm_explain:''};
			explain.term_id = setExplainList('explain_main_term_id',explain.term_id);
			explain.index_term = setExplainList('explain_index_term',explain.index_term);
			explain.index_kana = setExplainList('explain_index_kana',explain.index_kana);
			explain.index_add_letter = setExplainList('explain_index_add_letter',explain.index_add_letter);
			explain.nombre = setExplainList('explain_nombre',explain.nombre);
			explain.mainterm_explain = $('#form_mainterm [id=term_explain]').val();
			console.log(explain);

			$.post("{{ path('client.explain.save.ajax') }}", explain)
			.done(function(r,s){
				console.log('savePost:done',s,r);
				alert('解説内さくいん用語の登録が完了しました。');
			})
			.fail(function(e,s){
				console.log('savePost:fail',s,e.status);
				alert('DB更新エラー');
			});

			$('#explainModal').modal('hide');

		});

		function setExplainList(field,explain_attr){
			var explain_list = $('input[id="' + field + '"]');
			for(var i in explain_list){
				if(explain_list[i].value !== void 0){explain_attr.push(explain_list[i].value);}
			}
			return explain_attr;
		}

		// 用語登録
		$('.js-yougo-submit').bind('click', function(e){
			// 入力チェック
			var err_field = RequiredCheckMainTerm();

			// 主用語
			var mainterm = {};
			mainterm.update_mode = $('#form_mainterm [name=update_mode]').val();
			mainterm.version = $('#form_mainterm [name=version]').val();
			mainterm.hen = $('#form_mainterm [name=hen]').val();
			mainterm.sho = $('#form_mainterm [name=sho]').val();
			mainterm.dai = $('#form_mainterm [name=dai]').val();
			mainterm.chu = $('#form_mainterm [name=chu]').val();
			mainterm.ko = $('#form_mainterm [name=ko]').val();

			var print_order_list = $("#form_mainterm [name=print_order] option").map(function() {return $(this).val();}).get();
			console.log(print_order_list);
			mainterm.print_order_list = print_order_list;

			mainterm.term_id = parseInt($('#form_mainterm [name=term_id]').text().slice(1));
			mainterm.main_term = $('#form_mainterm [name=main_term]').val();
			mainterm.red_letter = $('#form_mainterm [name=red_letter]').prop("checked");
			mainterm.kana = $('#form_mainterm [name=kana]').val();
			mainterm.kana_exist = $('#form_mainterm [name=kana_exist]').prop("checked");
			mainterm.text_freq = $('#form_mainterm [name=text_freq]').val();
			mainterm.center_freq = $('#form_mainterm [id=center_freq]').text();
			mainterm.news_exam = $('#form_mainterm [name=news_exam]').prop("checked");
			mainterm.delimiter = $('#form_mainterm [name=delimiter]').val();
			mainterm.western_language = $('#form_mainterm [name=western_language]').val();
			mainterm.birth_year = $('#form_mainterm [name=birth_year]').val();
			mainterm.index_add_letter = $('#form_mainterm [name=index_add_letter]').val();
			mainterm.index_kana = $('#form_mainterm [name=index_kana]').val();
			mainterm.index_original_kana = $('#form_mainterm [id=index_original_kana]').val();
			mainterm.index_original = $('#form_mainterm [id=index_original]').val();
			mainterm.index_abbreviation = $('#form_mainterm [id=index_abbreviation]').val();
			mainterm.nombre = $('#form_mainterm [name=nombre]').text();
			mainterm.term_explain = $('#form_mainterm [id=term_explain]').val();
			mainterm.illust_filename = $('#form_illust [name=illust_filename]').val();
			mainterm.illust_caption = $('#form_illust [name=illust_caption]').val();
			mainterm.illust_kana = $('#form_illust [name=illust_kana]').val();
			mainterm.handover = $('#form_handover [id=handover]').val();

			// サブ用語
			var subterm = {sub_term_id:[],sub_term:[],red_letter:[],kana:[],kana_exist:[],text_freq:[],center_freq:[],news_exam:[],delimiter:[],delimiter_kana:[],index_add_letter:[],index_kana:[],nombre:[]};
			var form_subterm = $('.form_subterm');
			var err_field_sub = '';
			form_subterm.each(function(i,elem) {
				err_field_sub = RequiredCheckSubTerm($(elem),err_field);

				subterm.sub_term_id.push($(elem).find('#sub_term_id').val());
				subterm.sub_term.push($(elem).find('#sub_term').val());
				subterm.red_letter.push($(elem).find('#red_letter').prop("checked"));
				subterm.kana.push($(elem).find('#kana').val());
				subterm.kana_exist.push($(elem).find('#kana_exist').prop("checked"));
				subterm.text_freq.push($(elem).find('#text_freq').val());
				subterm.center_freq.push($(elem).find('#center_freq').text());
				subterm.news_exam.push($(elem).find('#news_exam').prop("checked"));
				subterm.delimiter.push($(elem).find('#delimiter').val());
				subterm.delimiter_kana.push($(elem).find('#delimiter_kana').val());
				subterm.index_add_letter.push($(elem).find('#index_add_letter').val());
				subterm.index_kana.push($(elem).find('#index_kana').val());
				subterm.nombre.push($(elem).find('#nombre').text());
			});

			console.log(subterm);
			mainterm.subterm = subterm;

			// 同対類用語
			var synterm = {syn_term_id:[],synonym_id:[],term:[],red_letter:[],text_freq:[],center_freq:[],news_exam:[],delimiter:[],index_add_letter:[],index_kana:[],nombre:[]};
			var form_synterm = $('.form_synterm');
			var err_field_syn = '';
			form_synterm.each(function(i,elem) {
				err_field_syn = RequiredCheckSynTerm($(elem),err_field);

				synterm.syn_term_id.push($(elem).find('#syn_term_id').val());
				synterm.synonym_id.push($(elem).find('#synonym_id').val());
				synterm.term.push($(elem).find('#syn_term').val());
				synterm.red_letter.push($(elem).find('#red_letter').prop("checked"));
				synterm.text_freq.push($(elem).find('#text_freq').val());
				synterm.center_freq.push($(elem).find('#center_freq').text());
				synterm.news_exam.push($(elem).find('#news_exam').prop("checked"));
				synterm.delimiter.push($(elem).find('#delimiter').val());
				synterm.index_add_letter.push($(elem).find('#index_add_letter').val());
				synterm.index_kana.push($(elem).find('#index_kana').val());
				synterm.nombre.push($(elem).find('#nombre').text());
			});

			console.log(synterm);
			mainterm.synterm = synterm;

			// 指矢印用語
			var refterm = {ref_idx:[],ref_term_id:[],nombre:[]};
			var form_refterm = $('.form_refterm');
			var err_field_ref = '';
			form_refterm.each(function(i,elem) {
				err_field_ref = RequiredCheckRefTerm($(elem),err_field);

				refterm.ref_idx.push($(elem).find('#ref_idx').val());
				refterm.ref_term_id.push($(elem).find('#ref_term').val());
				refterm.nombre.push($(elem).find('#nombre').text());
			});

			console.log(refterm);
			mainterm.refterm = refterm;

			// エラーチェック文言出力
			if((err_field != '')||(err_field_syn != '')||(err_field_ref != '')){
				alert("必須項目です。：" + err_field + err_field_sub + err_field_syn + err_field_ref);
				return false;
			}
			if((err_field == '')&&(err_field_sub != '')&&(err_field_syn == '')&&(err_field_ref == '')){
				if(confirm("ブランクですがよろしいですか？：" + err_field_sub) == false){
					return false;
				}
			}

			$.post("{{ path('client.edit.save.ajax') }}", mainterm)
			.done(function(r,s){
				console.log('savePost:done',s,r);
				window.location.href = "{{ path('client.yougo.index') }}";
			})
			.fail(function(e,s){
				console.log('savePost:fail',s,e.status);
				alert('DB更新エラー');
			});
		});

		function RequiredCheckMainTerm(){
			var err_filed = '';
			if($('#form_mainterm [name=curriculum]').val() == "0"){
				err_filed += '教科,';
			}
			if($('#form_mainterm [name=version]').val() == "0"){
				err_filed += '版,';
			}
			if($('#form_mainterm [name=hen]').val() == "0"){
				err_filed += '編見出し,';
			}
			if($('#form_mainterm [name=sho]').val() == "0"){
				err_filed += '章見出し,';
			}

			if($('#form_mainterm [name=main_term]').val() == ""){
				err_filed += '主用語,';
			}
			if($('#form_mainterm [name=term_explain]').val() == ""){
				err_filed += '解説,';
			}
			if($('#form_mainterm [name=index_kana]').val() == ""){
				err_filed += '主用語_索引用語読み,';
			}
			return err_filed;
		}

		function RequiredCheckSubTerm(elem,err_filed){
			var err_field_sub = '';
			if(elem.find('#sub_term').val() == ""){
				err_field_sub += 'サブ用語,';
			}
			if(elem.find('#index_kana').val() == ""){
				err_field_sub += 'サブ用語_索引用語読み,';
			}
			return err_field_sub;
		}

		function RequiredCheckSynTerm(elem,err_filed){
			var err_field_syn = '';
			if(elem.find('#syn_term').val() == ""){
				err_field_syn += '同対類用語,';
			}
			if(elem.find('#index_kana').val() == ""){
				err_field_syn += '同対類用語_索引用語読み,';
			}
			return err_field_syn;
		}

		function RequiredCheckRefTerm(elem,err_filed){
			var err_field_ref = '';
			if(elem.find('.js-hen4').val() == "0"){
				err_field_ref += '指矢印_編見出し,';
			}
			if(elem.find('.js-sho4').val() == "0"){
				err_field_ref += '指矢印_章見出し,';
			}
			console.log(elem.find('.js-term').val());
			if((elem.find('.js-term').val() == "0")||(elem.find('.js-term').val() == null)){
				err_field_ref += '指矢印用語,';
			}
			return err_field_ref;
		}

		function constructSubForm(record,center_sum){
			var html =
			'<div class="form-horizontal form_subterm">'
			+'<div class="form-group"><div class="col-xs-12">'
			+'<label class="col-xs-1">{{ "text.yougo.sub_term"|trans }}</label>'
			+'<div class="col-xs-3"><input class="form-control input-sm" type="text" id="sub_term" name="sub_term" value="' + (((record)&&(record.sub_term)) ? record.sub_term : '') + '"></div>'
			+'<label class="col-xs-1">{{ "text.yougo.red_letter"|trans }}</label>'
			+'<div class="col-xs-1"><input type="checkbox" id="red_letter" name="red_letter" ' + (((record)&&(record.red_letter == '1')) ? ' checked ' : '') + '></div>'
			+'<label class="col-xs-1">{{ "text.yougo.yomigana"|trans }}</label>'
			+'<div class="col-xs-3"><input class="form-control input-sm" type="text" id="kana" name="kana" value="' + (((record)&&(record.kana)) ? record.kana : '') + '"></div>'
			+'<label class="col-xs-1">{{ "text.yougo.kana_exist"|trans }}</label>'
			+'<div class="col-xs-1"><input type="checkbox" id="kana_exist" name="kana_exist" ' + (((record)&&(record.kana_exist_flag == '1')) ? ' checked ' : '') + '></div>'
			+'</div></div>'
			+'<div class="form-group"><div class="col-xs-12">'
			+'<label class="col-xs-1">{{ "text.yougo.freq.text"|trans }}</label>'
			+'<div class="col-xs-1"><input type="text" class="form-control input-sm js-text-freq2" term-id="' + ((record) ? record.id : '') + '" id="text_freq" name="text_freq" value="' + (((record)&&(record.text_frequency)) ? record.text_frequency : '') + '"></div>'
			+'<div class="col-xs-1"><div id="' + 'text_rank' + ((record) ? record.id : '') + '" value=""><div id="text_rank"></div></div></div>'
			+'<div class="col-xs-1"><button type="button" class="btn btn-primary btn-sm js-center-target2" term-id="' + ((record) ? record.id : '') + '" main-term-id="' + $('#form_mainterm [name=term_id]').text() + '" yougo-flag="2" data-toggle="modal" center-target="#centerModal">{{ "text.yougo.freq.center"|trans }}</button></div>'
			+'<div class="col-xs-1"><div id="' + 'center_freq' + ((record) ? record.id : '') + '" value=""><div id="center_freq" value="">' + ((center_sum)||(center_sum==0) ? center_sum : '') + '</div><input type="hidden" name="center_freq_text" value="test"></div></div>'
			+'<label class="col-xs-1">{{ "text.yougo.news.exam"|trans }}</label>'
			+'<div class="col-xs-2"><input type="checkbox" id="news_exam" name="news_exam" ' + (((record)&&(record.news_exam == '1')) ? ' checked ' : '') + '></div>'
			+'</div></div>'
			+'<div class="form-group"><div class="col-xs-12">'
			+'<label class="col-xs-1">{{ "text.yougo.delimiter"|trans }}</label>'
			+'<div class="col-xs-1"><select class="form-control input-sm" id="delimiter" name="delimiter">'
					+'<option value="0">なし</option>';

			html += '<option value="1" ' + (((record)&&(record.delimiter == '1')) ? ' selected ' : '') + '>と</option>'
			+'<option value="2" ' + (((record)&&(record.delimiter == '2')) ? ' selected ' : '') + '>，</option>'
			+'<option value="3" ' + (((record)&&(record.delimiter == '3')) ? ' selected ' : '') + '>・</option>'
			+'<option value="4" ' + (((record)&&(record.delimiter == '4')) ? ' selected ' : '') + '>／</option>'
			+'<option value="5" ' + (((record)&&(record.delimiter == '5')) ? ' selected ' : '') + '>（</option>'
			+'<option value="6" ' + (((record)&&(record.delimiter == '6')) ? ' selected ' : '') + '>）</option>'
			+'<option value="8" ' + (((record)&&(record.delimiter == '8')) ? ' selected ' : '') + '>）と</option>';

			html += '</select></div>'

			+'<label class="col-xs-1">{{ "text.yougo.delimiter_kana"|trans }}</label>'
			+'<div class="col-xs-1"><select class="form-control input-sm" id="delimiter_kana" name="delimiter_kana">'
					+'<option value="0">なし</option>';

			html += '<option value="1" ' + (((record)&&(record.delimiter_kana == '1')) ? ' selected ' : '') + '>と</option>'
			+'<option value="2" ' + (((record)&&(record.delimiter_kana == '2')) ? ' selected ' : '') + '>，</option>'
			+'<option value="3" ' + (((record)&&(record.delimiter_kana == '3')) ? ' selected ' : '') + '>・</option>'
			+'<option value="4" ' + (((record)&&(record.delimiter_kana == '4')) ? ' selected ' : '') + '>／</option>'
			+'<option value="5" ' + (((record)&&(record.delimiter_kana == '5')) ? ' selected ' : '') + '>（</option>'
			+'<option value="6" ' + (((record)&&(record.delimiter_kana == '6')) ? ' selected ' : '') + '>）</option>'
			+'<option value="7" ' + (((record)&&(record.delimiter_kana == '7')) ? ' selected ' : '') + '>）（</option>'
			+'<option value="8" ' + (((record)&&(record.delimiter_kana == '8')) ? ' selected ' : '') + '>）と</option>';

			html += '</select></div>'
			+'</div></div>'
			+'<div class="form-group"><div class="col-xs-12">'
			+'<label class="col-xs-1">{{ "text.yougo.index_letter"|trans }}</label>'
			+'<div class="col-xs-3"><input type="text" class="form-control input-sm" id="index_add_letter" name="index_add_letter" value="' + (((record)&&(record.index_add_letter)) ? record.index_add_letter : '') + '"></div>'
			+'<label class="col-xs-1">{{ "text.yougo.index_kana"|trans }}</label>'
			+'<div class="col-xs-3"><input type="text" class="form-control input-sm" id="index_kana" name="index_kana" value="' + (((record)&&(record.index_kana)) ? record.index_kana : '') + '"></div>'
			+'</div></div>'
			+'<div class="form-group"><div class="col-xs-12">'
			+'<label class="col-xs-1">{{ "text.yougo.nombre"|trans }}</label>'
			+'<label class="col-xs-1" id="nombre">{{ "' + (((record)&&(record.nombre)) ? record.nombre : '') + '" }}</label>'
			+'<div class="col-xs-1"><button type="button" class="btn btn-primary btn-sm js-sub-remove" term-id="' + ((record) ? record.id : '') + '">{{ "btn.remove.subterm"|trans }}</button></div>'
			+'<input type="hidden" class="form-control input-sm" id="sub_term_id" name="sub_term_id" value="' + ((record) ? record.id : '') + '">'
			+'</div></div><hr></div>';
			return html;
		}

		function constructSynForm(record,center_sum){
			var html =
			'<div class="form-horizontal form_synterm">'
			+'<div class="form-group"><div class="col-xs-12">'
			+'<label class="col-xs-1">{{ "text.yougo.icon"|trans }}</label>'
			+'<div class="col-xs-1"><select class="form-control input-sm" id="synonym_id" name="synonym_id">'
			+'<option value="1" ' + (((record)&&(record.synonym_id == '1')) ? ' selected ' : '') + '>同</option>'
			+'<option value="2" ' + (((record)&&(record.synonym_id == '2')) ? ' selected ' : '') + '>対</option>'
			+'<option value="3" ' + (((record)&&(record.synonym_id == '3')) ? ' selected ' : '') + '>類</option>'
			+'</select></div>'
			+'<label class="col-xs-1">{{ "text.yougo.syn_term"|trans }}</label>'
			+'<div class="col-xs-3"><input class="form-control input-sm" type="text" id="syn_term" name="syn_term" value="' + (((record)&&(record.term)) ? record.term : '') + '"></div>'
			+'<label class="col-xs-1">{{ "text.yougo.red_letter"|trans }}</label>'
			+'<div class="col-xs-1"><input type="checkbox" id="red_letter" name="red_letter" ' + (((record)&&(record.red_letter == '1')) ? ' checked ' : '') + '></div>'
			+'</div></div>'
			+'<div class="form-group"><div class="col-xs-12">'
			+'<label class="col-xs-1">{{ "text.yougo.freq.text"|trans }}</label>'
			+'<div class="col-xs-1"><input type="text" class="form-control input-sm js-text-freq3" term-id="' + ((record) ? record.id : '') + '" id="text_freq" name="text_freq" value="' + (((record)&&(record.text_frequency)) ? record.text_frequency : '') + '"></div>'
			+'<div class="col-xs-1"><div id="' + 'text_rank' + ((record) ? record.id : '') + '" value=""><div id="text_rank"></div></div></div>'
			+'<div class="col-xs-1"><button type="button" class="btn btn-primary btn-sm js-center-target3" term-id="' + ((record) ? record.id : '') + '" main-term-id="' + $('#form_mainterm [name=term_id]').text() + '" yougo-flag="3" data-toggle="modal" center-target="#centerModal">{{ "text.yougo.freq.center"|trans }}</button></div>'
			+'<div class="col-xs-1"><div id="' + 'center_freq' + ((record) ? record.id : '') + '" value=""><div id="center_freq" value="">' + ((center_sum)||(center_sum==0) ? center_sum : '') + '</div><input type="hidden" name="center_freq_text" value="test"></div></div>'
			+'<label class="col-xs-1">{{ "text.yougo.news.exam"|trans }}</label>'
			+'<div class="col-xs-2"><input type="checkbox" id="news_exam" name="news_exam" ' + (((record)&&(record.news_exam == '1')) ? ' checked ' : '') + '></div>'
			+'</div></div>'
			+'<div class="form-group"><div class="col-xs-12">'
			+'<label class="col-xs-1">{{ "text.yougo.delimiter"|trans }}</label>'
			+'<div class="col-xs-1"><select class="form-control input-sm" id="delimiter" name="delimiter">'
					+'<option value="0">なし</option>';

			html += '<option value="1" ' + (((record)&&(record.delimiter == '1')) ? ' selected ' : '') + '>全角スペース</option>'
			+'<option value="2" ' + (((record)&&(record.delimiter == '2')) ? ' selected ' : '') + '>（</option>'
			+'<option value="3" ' + (((record)&&(record.delimiter == '3')) ? ' selected ' : '') + '>）</option>'
			+'<option value="4" ' + (((record)&&(record.delimiter == '4')) ? ' selected ' : '') + '>改行</option>'
			+'<option value="5" ' + (((record)&&(record.delimiter == '5')) ? ' selected ' : '') + '>改行＋（</option>'
			+'<option value="6" ' + (((record)&&(record.delimiter == '6')) ? ' selected ' : '') + '>）＋改行</option>'

			html += '</select></div>'
			+'</div></div>'
			+'<div class="form-group"><div class="col-xs-12">'
			+'<label class="col-xs-1">{{ "text.yougo.index_letter"|trans }}</label>'
			+'<div class="col-xs-3"><input type="text" class="form-control input-sm" id="index_add_letter" name="index_add_letter" value="' + (((record)&&(record.index_add_letter)) ? record.index_add_letter : '') + '"></div>'
			+'<label class="col-xs-1">{{ "text.yougo.index_kana"|trans }}</label>'
			+'<div class="col-xs-3"><input type="text" class="form-control input-sm" id="index_kana" name="index_kana" value="' + (((record)&&(record.index_kana)) ? record.index_kana : '') + '"></div>'
			+'</div></div>'
			+'<div class="form-group"><div class="col-xs-12">'
			+'<label class="col-xs-1">{{ "text.yougo.nombre"|trans }}</label>'
			+'<label class="col-xs-1" id="nombre">{{ "' + (((record)&&(record.nombre)) ? record.nombre : '') + '" }}</label>'
			+'<div class="col-xs-1"><button type="button" class="btn btn-primary btn-sm js-syn-remove" term-id="' + ((record) ? record.id : '') + '">{{ "btn.remove.synterm"|trans }}</button></div>'
			+'<input type="hidden" class="form-control input-sm" id="syn_term_id" name="syn_term_id" value="' + ((record) ? record.id : '') + '">'
			+'</div></div><hr></div>';
			return html;
		}

		function constructRefForm(record){
			var html =
			'<div class="form-horizontal form_refterm">'
			+'<div class="form-group"><div class="col-xs-12">'
			+'<label class="col-xs-1">{{ "text.yougo.head.hen"|trans }}</label>'
			+'<div class="col-xs-3"><select class="form-control js-hen4 input-sm" name="ref_hen' + ((record) ? record.id : '') + '" term-id="' + ((record) ? record.id : '') + '">'
				+'<option value="0" term-id="' + ((record) ? record.id : '') + '">--------------</option>'
				+'{% for hen in hen_list %}'
					+'<option value="{{ hen.id }}" term-id="' + ((record) ? record.id : '') + '" ' + ((record) ? '{{ hen.id == select_hen ? " selected " : "" }}' : '') + '>{{ replaceTag(hen.name)|raw }}</option>'
				+'{% endfor %}'
			+'</select></div>'
			+'<label class="col-xs-1">{{ "text.yougo.head.sho"|trans }}</label>'
			+'<div class="col-xs-3"><select class="form-control js-sho4 input-sm" name="ref_sho' + ((record) ? record.id : '') + '" term-id="' + ((record) ? record.id : '') + '">'
				+'<option value="0">--------------</option>'
				+'{% for sho in sho_list %}'
					+'<option value="{{ sho.id }}" term-id="' + ((record) ? record.id : '') + '" ' + ((record) ? '{{ sho.id == select_sho ? " selected " : "" }}' : '') + '>{{ replaceTag(sho.name)|raw }}</option>'
				+'{% endfor %}'
			+'</select></div>'
			+'<label class="col-xs-1">{{ "text.yougo.head.dai"|trans }}</label>'
			+'<div class="col-xs-3"><select class="form-control js-dai4 input-sm" name="ref_dai' + ((record) ? record.id : '') + '" term-id="' + ((record) ? record.id : '') + '">'
				+'<option value="0">--------------</option>'
				+'{% for dai in dai_list %}'
					+'<option value="{{ dai.id }}" term-id="' + ((record) ? record.id : '') + '" ' + ((record) ? '{{ dai.id == select_dai ? " selected " : "" }}' : '') + '>{{ replaceTag(dai.name)|raw }}</option>'
				+'{% endfor %}'
			+'</select></div></div></div>'
			+'<div class="form-group"><div class="col-xs-12">'
			+'<label class="col-xs-1">{{ "text.yougo.head.chu"|trans }}</label>'
			+'<div class="col-xs-3"><select class="form-control js-chu4 input-sm" name="ref_chu' + ((record) ? record.id : '') + '" term-id="' + ((record) ? record.id : '') + '">'
				+'<option value="0">--------------</option>'
				+'{% for chu in chu_list %}'
					+'<option value="{{ chu.id }}" term-id="' + ((record) ? record.id : '') + '" ' + ((record) ? '{{ chu.id == select_chu ? " selected " : "" }}' : '') + '>{{ replaceTag(chu.name)|raw }}</option>'
				+'{% endfor %}'
			+'</select></div>'
			+'<label class="col-xs-1">{{ "text.yougo.head.ko"|trans }}</label>'
			+'<div class="col-xs-3"><select class="form-control js-ko input-sm" name="ref_ko' + ((record) ? record.id : '') + '" term-id="' + ((record) ? record.id : '') + '">'
				+'<option value="0">--------------</option>'
				+'{% for ko in ko_list %}'
					+'<option value="{{ ko.id }}" term-id="' + ((record) ? record.id : '') + '" ' + ((record) ? '{{ ko.id == select_ko ? " selected " : "" }}' : '') + '>{{ replaceTag(ko.name)|raw }}</option>'
				+'{% endfor %}'
			+'</select></div>'
			+'<label class="col-xs-1">{{ "text.yougo.refer_term"|trans }}</label>'
			+'<div class="col-xs-3"><select class="form-control js-term input-sm" name="ref_term' + ((record) ? record.id : '') + '" id="ref_term">'
			+'{% for refer_term in main_term_list %}'
				+'<option value="{{ refer_term.termId }}">{{ refer_term.mainTerm }}</option>'
			+'{% endfor %}'
			+'</select></div></div></div>'
			+'<div class="form-group"><div class="col-xs-12">'
			+'<div class="col-xs-1"><button type="button" class="btn btn-primary btn-sm js-ref-remove" term-id="' + ((record) ? record.id : '') + '">{{ "btn.remove.refterm"|trans }}</button></div>'
			+'<input type="hidden" class="form-control input-sm" id="ref_idx" name="ref_idx" value="' + ((record) ? record.id : '') + '">'
			+'</div></div><hr></div>';
			return html;
		}

		$('#addForm').click(function(){
			$.ajax({
				url: "{{ path('client.yougo.subterm.new.ajax') }}",
				method: 'POST',
				success: function(response){
						console.log(response);
						$('#form_subterms').append(
								constructSubForm(JSON.parse(response))
						);
				},
				error: function(response){
				}
			});
		});

		$('#addFormSyn').click(function(){
			$.ajax({
				url: "{{ path('client.yougo.synonym.new.ajax') }}",
				method: 'POST',
				success: function(response){
						console.log(response);
						$('#form_synterms').append(
								constructSynForm(JSON.parse(response))
						);
				},
				error: function(response){
				}
			});
		});

		var append_cnt = 0;
		$('#addFormRef').click(function(){
			append_cnt++;
			var obj = [];
			obj.id = 'new' + append_cnt;

			$('#form_refterms').append(
					constructRefForm(obj)
			);
			// 版選択後に指矢印用語の見出し設定し直す
			changeHanHeader($('[name="version"]'),'ref_hennew'+append_cnt);
			$('[name="ref_shonew' + append_cnt + '"]').empty();
			$('[name="ref_dainew' + append_cnt + '"]').empty();
			$('[name="ref_chunew' + append_cnt + '"]').empty();
			$('[name="ref_konew' + append_cnt + '"]').empty();
			$('[name="ref_termnew' + append_cnt + '"]').empty();

		});

		function getTextPoint(value,term_id,curriculum){
			var rank = '';
			if(curriculum == '1'){
				// 教科「現社」の場合
				if(value >= 8){
					rank = 'A';
				}else if((value >= 4)&&(value <= 7)){
					rank = 'B';
				}else if((value >= 1)&&(value <= 3)){
					rank = 'C';
				}
			}else{
				if(value >= 6){
					rank = 'A';
				}else if((value >= 3)&&(value <= 5)){
					rank = 'B';
				}else if((value >= 1)&&(value <= 2)){
					rank = 'C';
				}
			}
			$('#text_rank' + term_id + ' #text_rank').text(rank);
		}

		function getCenterPoint(e){
			// get target
			var target = $(e.currentTarget);
			var term_id = target.attr('term-id');
			var main_term_id = target.attr('main-term-id');
			var yougo_flag = target.attr('yougo-flag');
			var ver_id = $('#form_mainterm [name=version]').val();

			$('#term_id').val(term_id);
			$('#yougo_flag').val(yougo_flag);
			$('#formcenter').empty();

			// センター頻度の取得
			var data = {
				'term_id': term_id,
				'main_term_id': main_term_id,
				'yougo_flag': yougo_flag,
				'ver_id': ver_id
			};
			$.ajax({
				url: "{{ path('client.yougo.center.ajax') }}",
				data: data,
				method: 'POST',
				success: function(response){
					var html = '<div class="row"><div class="col-xs-12"><label class="col-xs-4"></label>'
					+'<label class="col-xs-4">本試</label><label class="col-xs-4">追試</label>'
					+'</div>'
					$('#formcenter').append(html);

					$.each(response, function(key, list){
						console.log(key);
						console.log(list.year);

						html = '<div class="row"><div class="col-xs-12"><label class="col-xs-4">' + list.year + '</label>'
						+'<input type="text" class="col-xs-4" id="center_main' + list.year + '" name="main' + list.year + '" value="' + list.mainExam + '">'
						+'<input type="text" class="col-xs-4" id="center_sub' + list.year + '" name="sub' + list.year + '" value="' + list.subExam + '">'
						+'</div>';

						$('#formcenter').append(html);
					});
				},
				error: function(response){
				}
			});

			$('#centerModal').modal();

		}

		function setHeaderSelectedIdx(id,hen,sho,dai,chu,ko){
			var data = {
					'id': id
			};
			$.ajax({
				url: "{{ path('client.yougo.header.ajax') }}",
				data: data,
				async: false,
				method: 'POST',
				success: function(response){
					console.log(response);
					$('[name="' + hen + '"]').val(response.hen); //編に紐づく章を選択状態にする
					$('[name="' + sho + '"]').val(response.sho);
					$('[name="' + dai + '"]').val(response.dai);
					$('[name="' + chu + '"]').val(response.chu);
					$('[name="' + ko + '"]').val(response.ko);
				},
				error: function(response){
				}
			});
		}

		function assignSubFormEvent(){
			// サブ用語　教科書頻度　イベント設定
			$(document).on("keydown keyup keypress change", ".js-text-freq2", function (e) {
				console.log("test");
				// get target
				var target = $(e.currentTarget);
				var term_id = target.attr('term-id');

				getTextPoint(e.currentTarget.value,term_id,"{{ curriculum }}");
			});
			// サブ用語　センター頻度　イベント設定
			$(document).on("click", ".js-center-target2", function (e) {
				getCenterPoint(e);
			});
			// サブ用語　削除
			$(document).on("click", ".js-sub-remove", function (e) {
				if(!window.confirm('用語データを削除します。よろしいですか。')){
					return false;
				}
				var target = $(e.currentTarget);
				var term_id = target.attr('term-id');
				console.log(term_id);

				var data = {
						'id': term_id,
						'table': 'SubTerm'
				};
				$.ajax({
					url: "{{ path('client.yougo.sub.delete.ajax') }}",
					data: data,
					async: false,
					method: 'POST',
					success: function(response){

					},
					error: function(response){
						alert('DB更新エラー');
					}
				});
				$(this).parents('.form_subterm').remove();
			});

			// 同対類用語　教科書頻度　イベント設定
			$(document).on("keydown keyup keypress change", ".js-text-freq3", function (e) {
				// get target
				var target = $(e.currentTarget);
				var term_id = target.attr('term-id');

				getTextPoint(e.currentTarget.value,term_id,"{{ curriculum }}");
			});
			// 同対類用語　センター頻度　イベント設定
			$(document).on("click", ".js-center-target3", function (e) {
				getCenterPoint(e);
			});
			// 同対類用語　削除
			$(document).on("click", ".js-syn-remove", function (e) {
				if(!window.confirm('用語データを削除します。よろしいですか。')){
					return false;
				}
				var target = $(e.currentTarget);
				var term_id = target.attr('term-id');
				console.log(term_id);

				var data = {
						'id': term_id,
						'table': 'Synonym'
				};
				$.ajax({
					url: "{{ path('client.yougo.sub.delete.ajax') }}",
					data: data,
					async: false,
					method: 'POST',
					success: function(response){

					},
					error: function(response){
						alert('DB更新エラー');
					}
				});

				$(this).parents('.form_synterm').remove();
			});

			// 指矢印用語　見出しイベント設定
			$(document).on("change", ".js-hen4", function (e) {
				var target = $(e.currentTarget);
				var term_id = target.attr('term-id');
				changeHenHeader($(e.currentTarget),'ref_sho'+term_id,'ref_dai'+term_id,'ref_chu'+term_id,'ref_ko'+term_id,'ref_term'+term_id);
			});

			$(document).on("change", ".js-sho4", function (e) {
				var target = $(e.currentTarget);
				var term_id = target.attr('term-id');
				changeShoHeader($(e.currentTarget),'ref_hen'+term_id,'ref_dai'+term_id,'ref_chu'+term_id,'ref_ko'+term_id,'ref_term'+term_id);
			});

			$(document).on("change", ".js-dai4", function (e) {
				var target = $(e.currentTarget);
				var term_id = target.attr('term-id');
				changeDaiHeader($(e.currentTarget),'ref_hen'+term_id,'ref_sho'+term_id,'ref_chu'+term_id,'ref_ko'+term_id,'ref_term'+term_id);
			});

			$(document).on("change", ".js-chu4", function (e) {
				var target = $(e.currentTarget);
				var term_id = target.attr('term-id');
				changeChuHeader($(e.currentTarget),'ref_hen'+term_id,'ref_sho'+term_id,'ref_dai'+term_id,'ref_ko'+term_id,'ref_term'+term_id);
			});

			// 指矢印用語　削除
			$(document).on("click", ".js-ref-remove", function (e) {
				if(!window.confirm('用語データを削除します。よろしいですか。')){
					return false;
				}
				var target = $(e.currentTarget);
				var term_id = target.attr('term-id');
				console.log(term_id);

				if((term_id != '')&&(term_id.indexOf('new') == -1)){
					var data = {
							'id': term_id,
							'table': 'Refer'
					};
					$.ajax({
						url: "{{ path('client.yougo.sub.delete.ajax') }}",
						data: data,
						async: false,
						method: 'POST',
						success: function(response){

						},
						error: function(response){
							alert('DB更新エラー');
						}
					});
				}

				$(this).parents('.form_refterm').remove();
			});
		}

	$(function(){
		$('.js-cur').bind('change', function(){
			changeCurriculumHeader($('.js-cur'));
		});

		$('.js-han').bind('change', function(){
			changeHanHeader($('.js-han'),'hen');
		});

		$('.js-hen').bind('change', function(){
			changeHenHeader($('.js-hen'),'sho','dai','chu','ko','print_order');
		});

		$('.js-sho').bind('change', function(){
			changeShoHeader($('.js-sho'),'hen','dai','chu','ko','print_order');
		});

		$('.js-dai').bind('change', function(){
			changeDaiHeader($('.js-dai'),'hen','sho','chu','ko','print_order');
		});

		$('.js-chu').bind('change', function(){
			changeChuHeader($('.js-chu'),'hen','sho','dai','ko','print_order');
		});

		$('.js-list-count').bind('change', function(){
			var form = $(this).closest('form');
			form.submit();
		});
	});

</script>