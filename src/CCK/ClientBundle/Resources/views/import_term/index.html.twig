{% extends "CCKClientBundle::layout.html.twig" %}

{% block stylesheets %}
	{{ parent() }}
{% endblock %}

{% block contents %}
<div class="row">
<blockquote class="blockquote-bottom pdr-0">
	<p>{{ 'text.csv.import.title'|trans|raw }}</p>
</blockquote>
</div>

<form action="{{ path('client.import_term.download') }}" class="form-horizontal" method="GET">
<div class="row">
	<div class="col-xs-12">
		<div class="panel panel-primary">
			<div class="panel-body">
				<div class="row">
					<div class="form-horizontal">
						<div class="">
							<div class="col-xs-12">
								<label class="col-xs-2">{{ 'text.csv.import_term.download'|trans }}</label>
								<div class="col-xs-2">
									<select class="form-control js-cur input-sm" name="curriculum">
										<option value="0">--------------</option>
										{% for cur in cur_list %}
											<option value="{{ cur.id }}">{{ cur.name }}</option>
										{% endfor %}
									</select>
								</div>
								<div class="col-xs-2">
									<select class="form-control js-han input-sm" name="version" disabled>
										<option value="0">--------------</option>
										{% for ver in ver_list %}
											<option value="{{ ver.id }}">{{ ver.name }}</option>
										{% endfor %}
									</select>
								</div>
								<div class="col-xs-1">
								</div>
								<div class="col-xs-1">
									<input type="hidden" name="type" value="0"/>
									<button class="btn btn-primary button_text_align input-sm" type="submit" onClick="return checkDownload('js-cur','js-han')">{{ 'btn.download'|trans }}</button>
								</div>
							</div>
							<div class="col-xs-5">
									{{ return_download }}
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
</form>

<form action="{{ path('client.import_term.upload') }}" class="form-horizontal" enctype='multipart/form-data' method='POST' novalidate>
<div class="row">
	<div class="col-xs-12">
		<div class="panel panel-primary">
			<div class="panel-body">
				<div class="row">
					<div class="form-horizontal">
						<div class="">
							<div class="col-xs-12">
								<label class="col-xs-2">{{ 'text.csv.import_term.upload'|trans }}</label>
								<div class="col-xs-2">
									<select class="form-control js-cur2 input-sm" name="curriculum">
										<option value="0">--------------</option>
										{% for cur in cur_list %}
											<option value="{{ cur.id }}">{{ cur.name }}</option>
										{% endfor %}
									</select>
								</div>
								<div class="col-xs-2">
									<select class="form-control js-han2 input-sm" name="version2" disabled>
										<option value="0">--------------</option>
										{% for ver in ver_list %}
											<option value="{{ ver.id }}">{{ ver.name }}</option>
										{% endfor %}
									</select>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="form-horizontal">
						<div class="">
							<div class="col-xs-12">
								<div class="col-xs-4">
									<input type="file" id="up_file" name="image">
								</div>
								<div class="col-xs-4">
									{{ return_message }}
								</div>
								<div class="col-xs-2"><button id="up_submit" name="up_submit_all" class="btn btn-primary btn-block" type="submit" onClick="return checkUpload('全項目')" disabled>{{ 'btn.upload.all'|trans }}</button></div>
								<div class="col-xs-2"><button id="up_submit2" name="up_submit_freq" class="btn btn-primary btn-block" type="submit" onClick="return checkUpload('頻度のみ')" disabled>{{ 'btn.upload.freq'|trans }}</button></div>
								<div id="status" style="visibility: hidden;">{{ status }}</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
</form>

<div class="row">
<blockquote class="blockquote-bottom pdr-0">
	<p>{{ 'text.csv.import.list'|trans|raw }}</p>
</blockquote>
</div>

<div class="row">
	<div class="col-xs-12">
		<table class="table table-responsive table-striped">
			<thead>
				<tr>
					<th width="80px" class="text-left">{{ 'text.yougo.curriculum'|trans }}</th>
					<th width="80px" class="text-left">{{ 'text.yougo.version'|trans }}</th>
					<th width="80px" class="text-left">{{ 'text.yougo.upload_date'|trans }}</th>
					<th width="120px" class="text-center">{{ 'text.yougo.upload_user'|trans }}</th>
					<th width="120px" class="text-center">{{ 'text.yougo.upload_file'|trans }}</th>
					<th width="120px" class="text-center">{{ 'text.csv.import.contents'|trans }}</th>
				</tr>
			</thead>
			<tbody>
				{% for upload in upload_list %}
				<tr class="text-center">
					<td class="text-left">{{ upload.cur_name }}</td>
					<td class="text-left">{{ upload.ver_name }}</td>
					<td class="text-left">{{ upload.create_date|date('Y/m/d H:i') }}</td>
					<td class="text-left">{{ upload.user_name }}</td>
					<td class="text-left">{{ upload.file_name }}</td>
					<td class="text-left">{{ upload.contents }}</td>
				</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>
</div>

<div class="modal-footer">
	<div class="text-center">
		<a href="{{ path('client.yougo.index') }}"><div class="btn btn-default" name="back">{{ 'btn.back'|trans }}</div></a>
	</div>
</div>

{% endblock %}

{% block javascripts %}
	{{ parent() }}
	<script>

	$(function(){
		$('.js-cur').bind('change', function(){
			changeCurriculumHeader($('.js-cur'));
		});

		$('.js-han').bind('change', function(){
			changeHanHeader($('.js-han'),'hen');
		});

		$('.js-cur2').bind('change', function(){
			changeCurriculumHeader($('.js-cur2'),'version2');
		});

	});

	function checkUpload(range){
		if(($('.js-cur2').val() == 0)||($('.js-han2').val() == 0)){
			alert("教科・版を選択してください。");
			return false;
		}

		if(confirm('教科・版に' + range +  '上書きされますがよろしいですか？')){
			return true;
		}else{
			return false;
		}
	}

	function logDownload(){
		$.ajax({
			url: "{{ path('client.log.download') }}",
			data: null,
			method: 'POST',
			success: function(response){
				alert("OK");
			},
			error: function(response){
				alert("NG");
			}
		});
	}

	// アップロード csv ボタンactive化
	$('#up_file').bind('change', function(){
		if(this.files && this.files[0]){
			$('#up_submit').attr('disabled', false);
			$('#up_submit2').attr('disabled', false);
		}
	});
	</script>
{% endblock %}
